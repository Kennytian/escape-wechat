# 使用 Node.js 作为基础镜像
FROM node:20

# 设置工作目录
WORKDIR /EscapeWechat

# 复制项目文件到工作目录
COPY . /EscapeWechat

# 安装 PM2
RUN npm install -g pm2

# 安装 background 依赖
WORKDIR /EscapeWechat/background
RUN npm install

# 安装 bot 依赖
WORKDIR /EscapeWechat/bot
RUN npm install

# 安装 frontground 依赖
WORKDIR /EscapeWechat/frontground
RUN npm install
RUN npm run build

FROM nginx:alpine
RUN rm -rf /usr/share/nginx/html/*

COPY /EscapeWechat/frontground/nginx.conf /etc/nginx/conf.d/default.conf
# 暴露端口
EXPOSE 3000 443 80

# 启动脚本
CMD ["nginx","-g","daemon off;"]